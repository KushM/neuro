
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>q4p1v1</title><meta name="generator" content="MATLAB 8.3"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2014-09-18"><meta name="DC.source" content="q4p1v1.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><pre class="codeinput">Ns = 100;
T = 500;
lambda = 0.001;
deltat = 0.1;
N = T/deltat;
event = zeros(N,Ns); <span class="comment">% array recording at each bucket if a stimulus arrived</span>
<span class="keyword">for</span> i = 1:Ns
    a = zeros(N,1);
    R = rand(size(a));
    a(R&lt;lambda*deltat) = 1; <span class="comment">% set each element of event to 1 with probability lambda*delta</span>
    event(:,i) = a;
<span class="keyword">end</span>


<span class="comment">%for i = 1:Ns</span>
<span class="comment">%    stimuli(i) = sum(event(i,:)==1);</span>
<span class="comment">%end</span>
event = reshape(event,Ns,N);
<span class="comment">%for i = 1:Ns</span>
<span class="comment">%    tk(i) = find(event(:,i)==1); % getting indices of arrivial</span>
<span class="comment">%end</span>
<span class="comment">%nspikes = size(tk);</span>
<span class="comment">%inter_arrival = diff(tk)*deltat; % interarrival times in seconds</span>
<span class="comment">%bin = 0:1:500;</span>
<span class="comment">%count = histc(inter_arrival,bin);</span>
<span class="comment">%figure; bar(bin,count,'histc'); % draw histogram of absolute count</span>
time = deltat:deltat:T;
<span class="comment">%figure, plot(time, event);</span>

<span class="comment">%for i = 1:Ns</span>
<span class="comment">%    figure, plot(time, event(i,:));</span>
<span class="comment">%end</span>

sigmaw = 25;
wo = 250;
Io = 10^(-12);
we = randn(1,Ns); <span class="comment">% synaptic strength</span>
we = wo + sigmaw*we;
tc_m = 15; <span class="comment">%time constant of membrane</span>
tc_s = tc_m/4; <span class="comment">%time constant of synapse</span>
count = 0;

Iapp = zeros(Ns,N);

<span class="keyword">for</span> i = 1:Ns
    tk = find(event(i,:)==1);
    [tkr,tkc] = size(tk);
    <span class="keyword">if</span> (tkc&gt;0)
        <span class="keyword">for</span> j = 1:N
            <span class="keyword">for</span> k = 1:tkc
                <span class="keyword">if</span>(tk(k)&lt;j)
                    Iapp(i,j) = Iapp(i,j) + (exp((tk(k)-j)*deltat/tc_m) - exp((tk(k)-j)*deltat/tc_s));
                <span class="keyword">end</span>
            <span class="keyword">end</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>

Japp = Iapp;

<span class="keyword">for</span> i = 1:Ns
    Iapp(i,:) = Iapp(i,:)*we(i)*Io;
<span class="keyword">end</span>
Iappf = sum(Iapp);

<span class="keyword">while</span> (1)
    [V, nspikes] = q1p2_func(1,0.5,Iappf,1);

    <span class="keyword">if</span> (nspikes == 0)
        <span class="keyword">break</span>;
    <span class="keyword">end</span>
    figure, plot(time,V);
    xlabel(<span class="string">'time'</span>);
    ylabel([<span class="string">'potential for iteration '</span> num2str(count+1)]);
    spiketimes = find(V == -0.058);
    [spr,spc] = size(spiketimes);
    count = count+1;
    <span class="keyword">for</span> j = 1:spc
        pos_max = spiketimes(spc);
        <span class="keyword">for</span> i=1:Ns
            tk = find(event(i,:)==1);
            tk = tk(tk&lt;pos_max);
            [tkr,tkc] = size(tk);
            <span class="keyword">if</span> (tkc&gt;0)
                deltatk = (pos_max-tk(tkc))*deltat;
                we(i)=max(10, we(i)*(1 - (exp(-deltatk/tc_m) - exp(-deltatk/tc_s))));
            <span class="keyword">end</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>
    <span class="keyword">for</span> i = 1:Ns
        Iapp(i,:) = Japp(i,:)*we(i)*Io;
    <span class="keyword">end</span>
    Iappf = sum(Iapp);
<span class="keyword">end</span>



we
count
figure, plot(time, V);
xlabel(<span class="string">'time'</span>);
ylabel(<span class="string">'final potential'</span>);
</pre><pre class="codeoutput">
we =

  Columns 1 through 7

  226.9502  283.7990  101.0771   23.2600  273.7531  318.5055  239.9986

  Columns 8 through 14

   10.0000  220.9317  250.9528  230.4031  221.6019  230.5526  251.3943

  Columns 15 through 21

  308.2393  249.1665  284.5810  237.7996   13.5719  250.3038  238.5978

  Columns 22 through 28

   11.5900  226.5789   13.7378   15.2808   10.0000  280.2335   77.2456

  Columns 29 through 35

   10.0000  271.4482   46.1351  227.5017  259.7823  249.3747   11.6479

  Columns 36 through 42

  283.2236   12.0854  242.8263  209.1155  211.7178   10.0000  220.2517

  Columns 43 through 49

   51.0045  197.3034   25.3956  243.8916  301.4431  228.5572  208.1504

  Columns 50 through 56

  272.2399  231.4556  218.6046  252.8335   10.0000  220.6178  236.9109

  Columns 57 through 63

  243.3529  252.5714  290.7914   40.5123  278.9071  248.8565   67.9500

  Columns 64 through 70

  231.8213  262.6340  248.3443  245.5824  163.6021   10.0000   10.0000

  Columns 71 through 77

   16.1747   36.5338  236.6417  103.9220  236.1619   10.0000  248.7897

  Columns 78 through 84

  254.8347  226.9516  236.7868  137.2588   28.6389  257.8179  208.3998

  Columns 85 through 91

  283.9865  240.9209  254.8465  109.0099  266.4013  249.2447  247.9905

  Columns 92 through 98

  265.0133  263.6912  229.4482  263.1595  251.4186   10.0000  239.8322

  Columns 99 through 100

  255.1509   10.0000


count =

     7

</pre><img vspace="5" hspace="5" src="q4p1v1_01.png" alt=""> <img vspace="5" hspace="5" src="q4p1v1_02.png" alt=""> <img vspace="5" hspace="5" src="q4p1v1_03.png" alt=""> <img vspace="5" hspace="5" src="q4p1v1_04.png" alt=""> <img vspace="5" hspace="5" src="q4p1v1_05.png" alt=""> <img vspace="5" hspace="5" src="q4p1v1_06.png" alt=""> <img vspace="5" hspace="5" src="q4p1v1_07.png" alt=""> <img vspace="5" hspace="5" src="q4p1v1_08.png" alt=""> <p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2014a</a><br></p></div><!--
##### SOURCE BEGIN #####

Ns = 100;
T = 500;
lambda = 0.001;
deltat = 0.1;
N = T/deltat; 
event = zeros(N,Ns); % array recording at each bucket if a stimulus arrived
for i = 1:Ns
    a = zeros(N,1);
    R = rand(size(a)); 
    a(R<lambda*deltat) = 1; % set each element of event to 1 with probability lambda*delta
    event(:,i) = a;
end


%for i = 1:Ns
%    stimuli(i) = sum(event(i,:)==1);
%end
event = reshape(event,Ns,N);
%for i = 1:Ns
%    tk(i) = find(event(:,i)==1); % getting indices of arrivial
%end
%nspikes = size(tk);
%inter_arrival = diff(tk)*deltat; % interarrival times in seconds
%bin = 0:1:500; 
%count = histc(inter_arrival,bin);
%figure; bar(bin,count,'histc'); % draw histogram of absolute count
time = deltat:deltat:T;
%figure, plot(time, event);

%for i = 1:Ns
%    figure, plot(time, event(i,:));
%end

sigmaw = 25;
wo = 250;
Io = 10^(-12);
we = randn(1,Ns); % synaptic strength
we = wo + sigmaw*we;
tc_m = 15; %time constant of membrane
tc_s = tc_m/4; %time constant of synapse
count = 0;

Iapp = zeros(Ns,N);

for i = 1:Ns
    tk = find(event(i,:)==1);
    [tkr,tkc] = size(tk);
    if (tkc>0)
        for j = 1:N
            for k = 1:tkc
                if(tk(k)<j)
                    Iapp(i,j) = Iapp(i,j) + (exp((tk(k)-j)*deltat/tc_m) - exp((tk(k)-j)*deltat/tc_s));
                end
            end
        end
    end
end

Japp = Iapp;

for i = 1:Ns
    Iapp(i,:) = Iapp(i,:)*we(i)*Io;
end
Iappf = sum(Iapp);

while (1)
    [V, nspikes] = q1p2_func(1,0.5,Iappf,1);
    
    if (nspikes == 0)
        break;
    end
    figure, plot(time,V);
    xlabel('time');
    ylabel(['potential for iteration ' num2str(count+1)]);
    spiketimes = find(V == -0.058);
    [spr,spc] = size(spiketimes);
    count = count+1;
    for j = 1:spc
        pos_max = spiketimes(spc);
        for i=1:Ns
            tk = find(event(i,:)==1); 
            tk = tk(tk<pos_max);                
            [tkr,tkc] = size(tk);
            if (tkc>0)
                deltatk = (pos_max-tk(tkc))*deltat;
                we(i)=max(10, we(i)*(1 - (exp(-deltatk/tc_m) - exp(-deltatk/tc_s))));
            end
        end
    end    
    for i = 1:Ns
        Iapp(i,:) = Japp(i,:)*we(i)*Io;
    end
    Iappf = sum(Iapp);
end



we
count
figure, plot(time, V);
xlabel('time');
ylabel('final potential');


##### SOURCE END #####
--></body></html>